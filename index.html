<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimal-ui">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>爸妈营游学</title>
		<link rel="stylesheet" href="css/bootstrap.css" />
		<link rel="stylesheet" href="css/index.css"/>
	</head>
	<body ng-app="angular.tripnstudy" ng-controller="ForeignTripnstudyController">
	<img src="https://mmbiz.qlogo.cn/mmbiz/u3O3jxfyE9BbaJYxtG1IxQfgnicPa4tVTGagqxJkhq1aFxpIp06qv9icfwkeibIMqicqHIr3ic1Zcicttf425WnicBvmA/0" style="max-height: 0px; margin:0px; position: absolute;"/>
		
		<div id="info" style="position:absolute;z-index:9999;"></div>
		<div class="covercon" style="position:absolute;top:0px;z-index:999;">
			<div class="toppart">
				<a class="titlelink" href="http://mp.weixin.qq.com/s?__biz=MjM5NjI4MDU4NA==&mid=208549061&idx=1&sn=f31898e8d8600ff081d29715cbffe650&scene=1&key=b2574200810f04e83a5c094dbb5bd76a431c334e328fdcbfc0a47200eec196e9c9befc4064a98da1e5ed64062ac6ed72&ascene=1&uin=ODkwMDg4OTIw&devicetype=webwx&version=70000001&pass_ticket=aBWzGKsv8P2XgHGnq4s1kEOiSiKTn5o52uMkvknz9aMOhRB91JDxsdhJZrLZ3bFk">
				<h1>2015年20个</h1>
				<h1>最好的美国游学夏令营</h1>
				<p class="line"></p>
				<div class="tipcon">
					 <span>策划制作： 爸妈营（微信号：bamaying）</span><button id="addbtn">关注</button>
				</div>
				</a>
				<div class="routetab"  type="age">
					<table cellpadding="0" cellspacing="0">
						<tr><td class="headtitle" colspan="6">6-60岁 各年龄适用</td>
						</tr>
							<td class="tabcell"><span>幼儿园</span></td>
							<td class="tabcell"><span>小学</span></td>
							<td class="tabcell"><span>初中</span></td>
							<td class="tabcell"><span>高中</span></td>
							<td class="tabcell"><span>亲子</span></td>
							<td class="tabcell"><span>成人</span></td>
						</tr>
					</table>
					<span class="checkbtncon"><b>查看</b></span>	
				</div>
				<div class="routetab" type="place">
					<table class="placesite" cellpadding="0" cellspacing="0">
						<tr><td class="headtitle" colspan="3">52个 权威美国游学地</td></tr>
						<tr>
							<td class="tabcell"><span>哈佛大学</span></td>
							<td class="tabcell"><span>斯坦福大学</span></td>
							<td class="tabcell"><span>哥伦比亚</span></td>
						</tr>
						<tr>
							<td class="tabcell"><span>耶鲁大学</span></td>
							<td class="tabcell"><span>麻省理工</span></td>
							<td class="tabcell"><span>硅谷</span></td>
						</tr>
						<tr>
							<td class="tabcell"><span>NASA</span></td>
							<td class="tabcell"><span>Discovery</span></td>
							<td class="tabcell"><span>UCLA</span></td>
						</tr>
						<tr>
							<td class="tabcell"><span>白宫</span></td>
							<td class="tabcell"><span>迪士尼乐园</span></td>
							<td class="tabcell"><span>环球影城</span></td>
						</tr>
					</table>
					<span class="checkbtncon"><b>查看</b></span>
				</div>
				<div class="routetab"  type="topic">
					<table cellpadding="0" cellspacing="0">
						<tr><td class="headtitle" colspan="3">26种 特色游学主题</td></tr>
						<tr>
							<td class="tabcell"><span>英语提高</span></td>
							<td class="tabcell"><span>留学准备</span></td>
							<td class="tabcell"><span>科技创新</span></td>
						</tr>
						<tr>
							<td class="colspan" colspan="3">
								<span style="margin:0 1%;">亲子</span>
								<span style="margin:0 1%;">户外探索</span>
								<span style="margin:0 1%;">经济金融</span>
								<span style="margin:0 1%;">专项学习</span>
							</td>
						</tr>
					</table>
					
					<span class="checkbtncon"><b>查看</b></span>
				</div>
				
				
				
				
				<div class="routetab"  type="startplace">
					<table cellpadding="0" cellspacing="0">
						<tr><td class="headtitle" colspan="3">全国自由出发</td></tr>
						<tr>
							<td class="tabcell"><span>上海出发</span></td>
							<td class="tabcell"><span>北京出发</span></td>
							<td class="tabcell"><span>广州出发</span></td>
						</tr>
						<tr>
							<td class="tabcell"><span>深圳出发</span></td>
							<td class="tabcell"><span>成都出发</span></td>
							<td class="tabcell"><span>美国集合</span></td>
						</tr>
					</table>
					
					<span class="checkbtncon"><b>查看</b></span>
				</div>
				
			</div>
			
				
			<div class="bottompart" style="background-color:#000;position:relative;opacity:0.5">
				<div style="width:100%;">
					<p class="titleline" style="font-size:20px;">合作伙伴</p>
					<p class="splitline"></p>
					<p style="padding-top:0;">斯坦福大学</p>
					<p>哈佛大学</p>
					<p>Worldstrides环识国际</p>
					<p>EF英孚教育</p>
				</div>
				
			</div>
		</div>
		
		<!---->
		<div class="contenthead">
			<a class="titlelink" href="http://mp.weixin.qq.com/s?__biz=MjM5NjI4MDU4NA==&mid=208549061&idx=1&sn=f31898e8d8600ff081d29715cbffe650&scene=1&key=b2574200810f04e83a5c094dbb5bd76a431c334e328fdcbfc0a47200eec196e9c9befc4064a98da1e5ed64062ac6ed72&ascene=1&uin=ODkwMDg4OTIw&devicetype=webwx&version=70000001&pass_ticket=aBWzGKsv8P2XgHGnq4s1kEOiSiKTn5o52uMkvknz9aMOhRB91JDxsdhJZrLZ3bFk">
			<h1>2015年20个</h1>
			<h1>最好的美国游学夏令营</h1>
			<p class="line"></p>
			<div class="tipcon">
				 <span>策划制作： 爸妈营（微信号：bamaying）</span><button id="addbtn">关注</button>
			</div>
			</a>
			<ul class="nav navbtncon">
				<li ng-repeat="o in tabs" ng-class="{'active':o.isActive,' ':o.isActive}"  ng-click="sortbytype(o)">{{o.text}}<i  ng-show="o.index" class="splitline"></i></li>
			</ul>
		</div>
		<div class="arrowcon uparrow"><span class="glyphicon glyphicon-menu-up"></span></div>
		<div class="arrowcon downarrow"><i class="glyphicon glyphicon-chevron-down"></i></div>
		<div class="arrowcon leftarrow"><i class="glyphicon glyphicon-chevron-left"></i></div>
		<div class="arrowcon rightarrow"><i class="glyphicon glyphicon-chevron-right"></i></div>
		<div class="contentcon" >
			<div class="preroutecon">
	
			</div>
			<div class="routecon">
					<div ng-repeat="o in tsdatas" class="item" ng-class="{'currentpage':o.curr,'otherpage':!o.curr}" index="{{$index}}">
						<div class="imgcon">
							<img ng-src="{{o.placeimgs[0]}}" style="width:100%;"/>
						</div>
						<h2 class="routename"><b>{{o.name}}</b></h2>
						<table class="table infotable" cellpadding="0" cellspacing="0">
							<tr><td class="title" style="border:none;">特色 ：</td><td class="content" style="border:none;">{{o.features}}</td></tr>
							<tr><td class="title">年龄 ：</td><td class="content">{{o.agedesc}}</td></tr>
							<tr><td class="title">游学地 ：</td><td class="content">{{o.placedesc}}</td></tr>
							<tr><td class="title">主题 ：</td><td class="content">{{o.topicdesc}}</td></tr>
							<tr><td class="title">主办 ：</td><td class="content">{{o.agency}}</td></tr>
							<tr><td class="title">日期 ：</td><td class="content">{{o.date}}</td></tr>
							<tr><td class="title">天数 ：</td><td class="content">{{o.days}}</td></tr>
							<tr><td class="title">出发 ：</td><td class="content">{{o.start}}</td></tr>
							<tr><td class="title">价格 ：</td><td class="content">{{o.price}}</td></tr>
							</tr>
						</table>

						<div class="btncon">
							<div class="checkbtn"><a href="{{o.link}}"><b>查看</b></a></div>
							<div class="zanbtn"><b>阅读 {{o.read}}</b></div>
						</div>
						<!--<button class="btn button" style="background-color:#{{o.bgc}}"><b>查看</b></button>-->
					</div>
			</div>
		</div>
		
		
		
		<script type="text/javascript" src="scripts/jquery.min.js"></script>
		<script type="text/javascript" src="scripts/jgestures.min.js"></script>
		<script type="text/javascript" src="scripts/angular-1.2.28.min.js"></script>
		<script type="text/javascript" src="scripts/ui-bootstrap-tpls-0.12.0.min.js"></script>
		<script type="text/javascript" src="scripts/jquery.easing.js"></script>
		<script type="text/javascript" src="scripts/jquery.history.js"></script>
		
		
		<script type="text/javascript">
				var ua=angular.module("angular.tripnstudy",[]);
				ua.run(["$rootScope",function($rs){
					$rs.tabs=[
						{"text":"年龄","type":"age","isActive":true,"index":0},
						{"text":"地点","type":"place","isActive":false,"index":1},
						{"text":"主题","type":"topic","isActive":false,"index":2},
						{"text":"主办","type":"host","isActive":false,"index":3}
					];
				}]).controller("ForeignTripnstudyController",["$rootScope","$scope",function($rs,$s){
					jQuery.getScript("scripts/data.js",function(){
						$s.tsdatas=_infodata;
						$s.$apply();
					});
					
					//$s.tsdatas=$rs.infodata;
					$s.tabs=$rs.tabs;
					$s.sortbytype=function(o){
						angular.forEach($s.tabs,function(v,i){v.isActive=false;});
						o.isActive=true;
						var testdeg=0;
						testrotate();
						
						
						function testrotate(){
							testdeg+=5;
							var _ii=parseInt(io[o.type])-1;
							var _s="100%";
							var _e=0;
							if(_ii<ii){
								_s="-100%";
								_e=0;
							}
							ii=parseInt(io[o.type])-1;
							
							$s.tsdatas=sortbycata(o.type,$s.tsdatas);
							//angular.forEach($s.tsdatas,function(v,i){if(i){v.curr=false}else{v.curr=true;}});
							//$s.$apply();
							
							if(ia===false){
								ia=true;
								ocon.css("left",_s);
								//var _html=ocon.html();
								//_html=_html.replace(/ng-src=(.*)style=\""/g," style=\"height:"+document.documentElement.clientWidth/2+"px;")
								pcon.show().css("opacity",1);
								//pcon.show().css({"opacity":1,"-webkit-transform-origin":"0 0","-webkit-transform":"rotateY(0)"});
								setTimeout(function(){
									$(".preroutecon .arrowcon").remove();
									//var _ww=document.documentElement.clientWidth;
									ocon.animate({"left":_e},{
										  step: function(now, fx) {
										  	//var rate=(_ww-now)/_ww
										    //pcon.css({"-webkit-transform":"rotateY(-"+rate*60+"deg)","opacity":(1-rate)});
										  },
										  easing:"easeInOutQuint",
										  complete:function(){
										  	var _html=ocon.html();
											_html=_html.replace(/ng-src=(.*)style"/g," style")
											pcon.html(_html).show().css("opacity",1);
										  	pcon.css("left",0).hide();
											ia=false;
										  }
										});
								});
							}
							
						}
					}
					
					$(".routecon").bind("customevent",function(event,index,dir){
							angular.forEach($s.infodata,function(v,i){v.curr=false;});
							index=parseInt(index);
							if(dir=="up"){
								index++;
							}else if(dir=="down"){
								index--;
							}
							var curr=$s.infodata[index];
							if(curr){
								curr.curr=true;
							}
							$s.$apply();	
					}).bind("entercontent",function(event,type){
						ii=parseInt(io[type])-1;
						console.log(ii)
						$.tsdatas=sortbycata(type,$s.tsdatas);
						angular.forEach($s.tsdatas,function(v,i){
							for(var j=0;j<v.imgurl.length;j++){
								$("<img src="+v.imgurl[j]+"  />").load(function(e){
									if(v.placeimgs[0].indexOf("transparent")>0){
										v.placeimgs=[];
									}
									v.placeimgs.push(this.src);
									$s.$apply();
									var _html=ocon.html();
									_html=_html.replace(/ng-src=(.*)style"/g," style");
									pcon.html(_html).css("left",0).hide();
								});
							}
							if(i){v.curr=false;}else{v.curr=true;}
						});
						angular.forEach($s.tabs,function(v,i){
							if(i==ii){
								v.isActive=true;
							}else{
								v.isActive=false;
							}
						})
					});
					
					var ocon=$(".contentcon .routecon");
					var pcon=$(".contentcon .preroutecon");
					var io={"0":"age","1":"place","2":"topic","3":"host","age":1,"place":2,"topic":3,"host":4};
					var ii=0;
					//ocon.bind("swiperight",swipr).bind("swiperightup",swipr).bind("swiperightdown",swipr);
					//ocon.bind("swipeleft",swipl).bind("swipeleftup",swipl).bind("swipeleftdown",swipl);
					
					
					
					var ia=false;
					function swipr(e,a){
						
						var dx=Math.abs(a.delta[0].lastX);
						var dy=Math.abs(a.delta[0].lastY);
						if(ia===false && ii>0 && dx/dy>2){
							ia=true;
							pcon.html(ocon.html());
							$(".preroutecon .arrowcon").remove();
							ocon.css("left","-100%");
							pcon.show();
							var _ww=document.documentElement.clientWidth;
						
							ii--;
							$s.tsdatas=sortbycata(io[(""+(ii))],$s.tsdatas);
							$s.$apply();
							pcon.css({"-webkit-transform-origin":"100% 0","opacity":1});
							ocon.animate({"left":0},{
								  step: function(now, fx) {
								  	var rate=(_ww+now)/_ww
								    pcon.css({"-webkit-transform":"rotateY(-"+rate*60+"deg)","opacity":(1-rate)});
								  },
								  complete:function(){
								  	if(ii==0){
								  		$(".rightarrow").show();
								  		$(".leftarrow").hide();
								  	}else if(ii==3){
								  		$(".leftarrow").show();
								  		$(".rightarrow").hide();
								  	}else{
								  		$(".leftarrow").show();
								  		$(".rightarrow").show();
								  	}
								  	setTimeout(function(){$(".leftarrow").hide();$(".rightarrow").hide();},1000);
								  	pcon.css("left",0).hide();
									pcon.css("left",0).hide();
									angular.forEach($s.tabs,function(v,i){
										if(i==ii){
											v.isActive=true;
										}else{
											v.isActive=false;
										}
									});
									$s.$apply();
									ia=false;
								  }
								});
						}
						
					}
					
					function swipl(e,a){
						var dx=Math.abs(a.delta[0].lastX);
						var dy=Math.abs(a.delta[0].lastY);
						if(ia===false && ii<3 && dx/dy>2){
							ia=true;
							pcon.html(ocon.html());
							$(".preroutecon .arrowcon").remove();
							ocon.css("left","100%");
							pcon.show();
							var _ww=document.documentElement.clientWidth;
							//$(".navbtncon").css({"width":"50%","right":0});
							ii++;
							
							$s.tsdatas=sortbycata(io[(""+(ii))],$s.tsdatas);
							$s.$apply();
							
							
							pcon.css({"-webkit-transform-origin":"0 0","opacity":1});
							//return;
							ocon.animate({"left":0},{
								  step: function(now, fx) {
								  	var rate=(_ww-now)/_ww
								    pcon.css({"-webkit-transform":"rotateY(-"+rate*60+"deg)","opacity":(1-rate)});
								  },
								  complete:function(){
								  	if(ii==0){
								  		$(".rightarrow").show();
								  		$(".leftarrow").hide();
								  	}else if(ii==3){
								  		$(".leftarrow").hide();
								  		$(".rightarrow").show();
								  	}else{
								  		$(".leftarrow").show();
								  		$(".rightarrow").show();
								  	}
								  	setTimeout(function(){$(".leftarrow").hide();$(".rightarrow").hide();},1000);
								  	pcon.css("left",0).hide();
									angular.forEach($s.tabs,function(v,i){
										if(i==ii){
											v.isActive=true;
										}else{
											v.isActive=false;
										}
									});
									$s.$apply();
									ia=false;
								  }
								});
						}	
					}
				}]);
				

				
				
				
				
				
				
				//
				
				
				var sx,sy,cx,cy=0;
				var st,et=0;
				var xdeg=0,ztrnas=0;
				var tarindex=0;
				//$(".contentcon").bind("touchstart",touchstartfunc);
				
				function touchstartfunc(event){
					var e=event.originalEvent;
					var tl=e.changedTouches;
					sx=tl[0].clientX;
					sy=tl[0].clientY;
					cx=0;
					cy=0;
					$(".contentcon").bind("touchmove",touchmovefunc).bind("touchend",touchendfunc);
				}
				
				function touchmovefunc(event){
					var e=event.originalEvent;
					var tl=e.changedTouches;
					if(cx==0 && cy==0){
						cx=tl[0].clientX;
						cy=tl[0].clientY;
						var dx=Math.abs(cx-sx);
						var dy=Math.abs(cy-sy);
						if(dx/dy>1){
							
							$(".contentcon").bind("touchmove",function(e){e.preventDefault()})
						}else{}
					}else{
						
					}
					
				}
				
				function touchendfunc(){
					$(".contentcon").unbind("touchmove").unbind("touchend",touchendfunc);
				}
				
				
				
				function touchendFunc(event){
					var tar=$(this);
					var e=event.originalEvent;
					var tl=e.changedTouches;
					var dy=(tl[0].clientY-sy);
					et=new Date().valueOf();
					
					$(".contentcon .routecon .uparrow").hide();
					$(".contentcon .routecon .downarrow").hide();
					var diffy=0;
					//-up +down
					if(dy){
						if((et-st)>100){
							diffy=20
						}
						if(dy>diffy){
							if(tarindex){
								var tar=$(".currentpage");
								var index=tar.attr("index");
								tar.prev().removeClass("otherpage").addClass("down-nextpage");
								tar.addClass("down-fadeout");
								setTimeout(function(){
									//tar.before(last.addClass("currentpage").removeClass("down-nextpage"));
									tar.prev().addClass("currentpage").removeClass("down-nextpage");
									tar.removeClass("currentpage").removeClass("down-fadeout").addClass("otherpage");
									$(".routecon").trigger("customevent",[index,"down"]);
								},500);
							}
							
						}else if(dy<-diffy){
							if(tarindex<4){
								var tar=$(".currentpage");
								var index=tar.attr("index");
								tar.next().removeClass("otherpage").addClass("up-nextpage");
								tar.addClass("up-fadeout");
								setTimeout(function(){
									tar.next().addClass("currentpage").removeClass("up-nextpage");
									tar.removeClass("currentpage").removeClass("up-fadeout").addClass("otherpage")//.appendTo($(".routecon"));
									$(".routecon").trigger("customevent",[index,"up"]);
								},500);
							}
							
						}
					}else{
						return;
					}
					$(".routecon").unbind("touchend");
				}
				
				function stopEvent(e){
					e.stopPropagation();
					e.preventDefault();
				}
				
				window.requestAnimFrame = function() {
				  return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function(e, t) {
				    return window.setTimeout(e, 1e3 / 60)
				  };
				}();
				
				
				function sortbycata(type,data){
					for(var i=0;i<(data.length-1);i++){
						for(var j=1;j<(data.length-i);j++){
							var _l=parseInt(data[j-1][type]);
							var _r=parseInt(data[j][type]);
							
							var _temp
							if(_l>_r){
								_temp=data[j-1];
								data[j-1]=data[j];
								data[j]=_temp;
							}
						}
					}
					
					return data;
				}
				
				
				$(document).ready(function(){
					var History = window.History;
				    if ( History.enabled ) {
				        History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
					        var State = History.getState(); // Note: We are using History.getState() instead of event.state
					        //console.log(State);
					        //console.log(State.data.state)
					        if(State && !State.data.state){
					        	$(window).scrollTop(0);
								$(".covercon").show();
								var nav=$(".contenthead").hide();
								var con=$(".contentcon").hide();
								$(".downarrow").hide();
					        }
					    });
				    }
				    
					
					var wh=document.documentElement.clientHeight;
					var ww=document.documentElement.clientWidth;
					var tabs=$(".navbtncon li").css("line-height",(wh*0.05)+"px");
					var tabcon=$(".navbtncon");
					$(".checkbtn,.zanbtn").css("line-height",(wh*0.05)+"px");
					$(".navbtncon").css("width",document.documentElement.clientWidth+"px");
					
					$(window).scroll(function(){
						var con=$(".contentcon");
						
						if(con.height()>0){
							var st=con.height()-document.documentElement.clientHeight+$(".contenthead").height();
							if($(this).scrollTop()>=st){
								$(".downarrow").hide();
							}else{
								$(".downarrow").show();
							}
						}
					})
					//if(wh>500){
					if(0){
						$(".contentcon .routecon").css({"height":(wh-tabcon.outerHeight())+"px","top":tabcon.outerHeight()+"px"});
						$(".routecon").on("touchstart",".item",function(event){
							var tar=$(this);
							var e=event.originalEvent;
							var tl=e.changedTouches;
							tarindex=$(event.target).parents(".item").attr("index");
							if(tarindex===undefined){
								tarindex=$(event.target).attr("index");
							}
							tarindex=parseInt(tarindex);
							if(tarindex){
								if(tarindex<4){
									$(".contentcon .routecon .uparrow").show();
									$(".contentcon .routecon .downarrow").show();
								}else{
									$(".contentcon .routecon .uparrow").show();
								}
							}else{
								$(".contentcon .routecon .downarrow").show();	
							}
							st=new Date().valueOf();
							if(tl.length==1){
								cx=sx=tl[0].clientX;
								cy=sy=tl[0].clientY;
								
								tar.bind("touchmove",stopEvent);
								tar.bind("touchend",touchendFunc);
							}else{
								//tar.unbind("touchmove").unbind("touchend");
							}
						});
					}else{
						setTimeout(function(){
							var nav=$(".navbtncon")//.css("position","fixed")
							var con=$(".contentcon .routecon");
							con.css({"top":nav.outerHeight()});
							$(".contentcon .preroutecon").css({"top":nav.outerHeight()}).hide();
							var items=$(".item",$(".contentcon .routecon")).removeClass("otherpage").addClass("currentpage");
						},500)
					}
					
					$(".routetab").each(function(i,v){
						var tar=$(this);
						var btn=$(".checkbtncon",tar)
						btn.css("left",((tar.outerWidth()-4-btn.outerWidth())/2)).bind("touchstart",function(){
							$("b",$(this)).addClass("hover");
						}).bind("touchend",function(){
							$("b",$(this)).removeClass("hover");
						});
						$(this).click(function(){
							var _t=$(this);
							var _type=[_t.attr("type")];
							$(".routecon").trigger("entercontent",[_t.attr("type")]);
							History.pushState({state:1,rand:Math.random()}, "爸妈营游学", "?state=1");
							$(window).scrollTop(0);
							$(".covercon").hide();
							var nav=$(".contenthead").show();
							var con=$(".contentcon").show().css({"top":nav.outerHeight(),"height":$(".routecon").outerHeight()});
							$(".downarrow").show();
						});
					});
					
					$(".routetab table td").each(function(i,v){
						var tar=$(this);
						if(tar.hasClass("tabcell")){
							tar.bind("touchstart",function(){$(this).addClass("active")}).bind("touchend",function(){$(this).removeClass("active")});
						}
						if(tar.hasClass("colspan")){
							$("span",tar).bind("touchstart",function(){$(this).addClass("active")}).bind("touchend",function(){$(this).removeClass("active")});
						}
					});
				});
			
		</script>
	</body>
</html>
